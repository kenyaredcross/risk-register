import{D as H,o,e as r,f as e,h as A,w as S,m as h,n as f,F as k,C as _,j as p,v as j,x as g,y as V,t as i,k as P,r as u,H as D}from"./vue-vendor-DORe5Ms0.js";import{u as q}from"./useApi-Dztx0DcP.js";import"./index-CtnbHJYv.js";const G={class:"animate-fade-in"},I={class:"mb-6 border-b border-light-border"},J={class:"flex space-x-6"},O={class:"mb-6 flex items-center justify-between"},Q={key:0,class:"flex items-center justify-center py-20"},W={key:1,class:"card overflow-hidden"},X={class:"overflow-x-auto"},Y={class:"w-full"},Z={class:"divide-y divide-light-border"},ee={class:"px-4 py-3 text-sm text-charcoal font-medium"},te={class:"px-4 py-3 text-sm text-medium-gray"},se={class:"px-4 py-3"},le={class:"px-4 py-3"},ae={class:"flex flex-wrap gap-1"},oe={key:0,class:"text-xs text-medium-gray"},re={class:"px-4 py-3 text-right"},ne=["onClick"],ie=["onClick"],de={key:0,class:"text-center py-12 text-medium-gray"},ue={class:"bg-white rounded-lg shadow-elegant-xl max-w-lg w-full p-6"},ce={class:"space-y-4 mb-4"},me={class:"grid grid-cols-2 gap-2"},xe=["value"],pe={key:0,class:"text-sm text-red-600 mb-3"},ve={class:"flex space-x-3"},be=["disabled"],fe={class:"bg-white rounded-lg shadow-elegant-xl max-w-lg w-full p-6"},ge={class:"text-sm text-medium-gray mb-4"},ye={class:"space-y-4 mb-4"},he={class:"grid grid-cols-2 gap-2"},ke=["value"],_e={key:0,class:"text-sm text-red-600 mb-3"},we={class:"flex space-x-3"},Ce=["disabled"],Ee={__name:"Users",setup(Ne){const v=q(),w=u([]),C=u([]),N=u(!1),d=u(!1),n=u(""),U=u(!1),a=u({email:"",firstName:"",lastName:"",roles:[]}),R=u(!1),m=u(null),b=u({roles:[]}),y=async()=>{N.value=!0,w.value=await v.getUsers(),N.value=!1},K=async()=>{const l=await v.getAdminMeta();C.value=l.krcs_roles||[]},M=()=>{U.value=!1,a.value={email:"",firstName:"",lastName:"",roles:[]},n.value=""},B=async()=>{if(!a.value.email||!a.value.firstName)return;d.value=!0,n.value="";const l=await v.createUser(a.value.email,a.value.firstName,a.value.lastName,a.value.roles);d.value=!1,l.success?(M(),await y()):n.value=l.message||"Failed to create user"},z=l=>{m.value=l,b.value.roles=[...l.krcs_roles],R.value=!0,n.value=""},E=()=>{R.value=!1,m.value=null,b.value={roles:[]},n.value=""},L=async()=>{if(!m.value)return;d.value=!0,n.value="";const l=await v.updateUserRoles(m.value.name,b.value.roles);d.value=!1,l.success?(E(),await y()):n.value=l.message||"Failed to update roles"},T=async l=>{const t=l.enabled?"disable":"enable";if(!confirm(`${t.charAt(0).toUpperCase()+t.slice(1)} user "${l.full_name||l.email}"?`))return;d.value=!0,n.value="";const x=await v.toggleUserEnabled(l.name,!l.enabled);d.value=!1,x.success?await y():n.value=x.message||`Failed to ${t} user`};return H(async()=>{await Promise.all([y(),K()])}),(l,t)=>{var $,F;const x=P("router-link");return o(),r("div",G,[t[20]||(t[20]=e("div",{class:"mb-6"},[e("h1",{class:"text-3xl font-bold text-charcoal mb-2"},"Administration"),e("p",{class:"text-medium-gray"},"Manage departments, users, and roles")],-1)),e("div",I,[e("nav",J,[A(x,{to:"/admin/departments",class:f(["pb-3 px-1 border-b-2 font-medium text-sm transition-colors",l.$route.path==="/admin/departments"?"border-red-primary text-red-primary":"border-transparent text-medium-gray hover:text-charcoal hover:border-light-border"])},{default:S(()=>[...t[6]||(t[6]=[h(" Departments & Units ",-1)])]),_:1},8,["class"]),A(x,{to:"/admin/users",class:f(["pb-3 px-1 border-b-2 font-medium text-sm transition-colors",l.$route.path==="/admin/users"?"border-red-primary text-red-primary":"border-transparent text-medium-gray hover:text-charcoal hover:border-light-border"])},{default:S(()=>[...t[7]||(t[7]=[h(" Users ",-1)])]),_:1},8,["class"]),A(x,{to:"/admin/roles",class:f(["pb-3 px-1 border-b-2 font-medium text-sm transition-colors",l.$route.path==="/admin/roles"?"border-red-primary text-red-primary":"border-transparent text-medium-gray hover:text-charcoal hover:border-light-border"])},{default:S(()=>[...t[8]||(t[8]=[h(" Roles Reference ",-1)])]),_:1},8,["class"])])]),e("div",O,[t[10]||(t[10]=e("div",null,[e("h2",{class:"text-xl font-bold text-charcoal mb-1"},"User Management"),e("p",{class:"text-sm text-medium-gray"},"Manage users and their KRCS roles")],-1)),e("button",{onClick:t[0]||(t[0]=s=>U.value=!0),class:"btn btn-primary"},[...t[9]||(t[9]=[e("svg",{class:"w-5 h-5 inline mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),h(" Add User ",-1)])])]),N.value?(o(),r("div",Q,[...t[11]||(t[11]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-primary"},null,-1)])])):(o(),r("div",W,[e("div",X,[e("table",Y,[t[12]||(t[12]=e("thead",{class:"bg-light-gray"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Name"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Email"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"KRCS Roles"),e("th",{class:"px-4 py-3 text-right text-xs font-semibold text-charcoal uppercase"},"Actions")])],-1)),e("tbody",Z,[(o(!0),r(k,null,_(w.value,s=>(o(),r("tr",{key:s.name,class:"hover:bg-off-white transition-colors"},[e("td",ee,i(s.full_name||s.name),1),e("td",te,i(s.email),1),e("td",se,[e("span",{class:f(["px-2 py-1 rounded-full text-xs font-semibold",s.enabled?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"])},i(s.enabled?"Active":"Disabled"),3)]),e("td",le,[e("div",ae,[(o(!0),r(k,null,_(s.krcs_roles,c=>(o(),r("span",{key:c,class:"px-2 py-1 bg-red-light text-red-dark rounded text-xs font-medium"},i(c),1))),128)),s.krcs_roles.length===0?(o(),r("span",oe,"No roles")):p("",!0)])]),e("td",re,[e("button",{onClick:c=>z(s),class:"text-sm text-red-primary hover:text-red-dark font-medium mr-3"}," Edit Roles ",8,ne),e("button",{onClick:c=>T(s),class:f(["text-sm hover:underline",s.enabled?"text-medium-gray":"text-green-600"])},i(s.enabled?"Disable":"Enable"),11,ie)])]))),128))])])]),w.value.length===0?(o(),r("div",de," No users found ")):p("",!0)])),U.value?(o(),r("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:j(M,["self"])},[e("div",ue,[t[17]||(t[17]=e("h3",{class:"text-lg font-bold text-charcoal mb-4"},"Create New User",-1)),e("div",ce,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-charcoal mb-1"},"Email *",-1)),g(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.email=s),type:"email",class:"input w-full",placeholder:"user@redcross.or.ke"},null,512),[[V,a.value.email]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-charcoal mb-1"},"First Name *",-1)),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.firstName=s),type:"text",class:"input w-full"},null,512),[[V,a.value.firstName]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-charcoal mb-1"},"Last Name",-1)),g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.lastName=s),type:"text",class:"input w-full"},null,512),[[V,a.value.lastName]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-charcoal mb-2"},"Assign KRCS Roles",-1)),e("div",me,[(o(!0),r(k,null,_(C.value,s=>(o(),r("label",{key:s,class:"flex items-center space-x-2 text-sm"},[g(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[4]||(t[4]=c=>a.value.roles=c),class:"rounded"},null,8,xe),[[D,a.value.roles]]),e("span",null,i(s),1)]))),128))])])]),n.value?(o(),r("div",pe,i(n.value),1)):p("",!0),e("div",ve,[e("button",{onClick:M,class:"btn btn-outline flex-1"},"Cancel"),e("button",{onClick:B,disabled:d.value||!a.value.email||!a.value.firstName,class:"btn btn-primary flex-1"},i(d.value?"Creating...":"Create User"),9,be)])])])):p("",!0),R.value?(o(),r("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:j(E,["self"])},[e("div",fe,[t[19]||(t[19]=e("h3",{class:"text-lg font-bold text-charcoal mb-1"},"Edit KRCS Roles",-1)),e("p",ge,i((($=m.value)==null?void 0:$.full_name)||((F=m.value)==null?void 0:F.email)),1),e("div",ye,[e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-charcoal mb-2"},"Assign KRCS Roles",-1)),e("div",he,[(o(!0),r(k,null,_(C.value,s=>(o(),r("label",{key:s,class:"flex items-center space-x-2 text-sm"},[g(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[5]||(t[5]=c=>b.value.roles=c),class:"rounded"},null,8,ke),[[D,b.value.roles]]),e("span",null,i(s),1)]))),128))])])]),n.value?(o(),r("div",_e,i(n.value),1)):p("",!0),e("div",we,[e("button",{onClick:E,class:"btn btn-outline flex-1"},"Cancel"),e("button",{onClick:L,disabled:d.value,class:"btn btn-primary flex-1"},i(d.value?"Saving...":"Save Roles"),9,Ce)])])])):p("",!0)])}}};export{Ee as default};
