import{a as i}from"./index-Dy9jsXtf.js";import{r as m}from"./vue-vendor-DORe5Ms0.js";function O(){const c=m(!1),n=m(null);return{loading:c,error:n,fetchRisks:async()=>{c.value=!0,n.value=null;try{return(await i.get("/api/resource/Program Risk Register",{params:{fields:JSON.stringify(["name","project","risk_category","risk_description","likelihood","impact","overall_rating","risk_level","risk_owner","department","region","status","review_frequency","next_review_due","review_status","timeline","status","approved_by","approval_date","rejection_reason","creation","modified"]),limit_page_length:0}})).data.data||[]}catch(a){return n.value=a.message||"Failed to fetch risks",console.error("API Error:",a),[]}finally{c.value=!1}},fetchRisk:async a=>{c.value=!0,n.value=null;try{return(await i.get(`/api/resource/Program Risk Register/${a}`)).data.data||null}catch(e){return n.value=e.message||"Failed to fetch risk",console.error("API Error:",e),null}finally{c.value=!1}},getRiskStats:a=>{const e={total:a.length,critical:0,high:0,medium:0,low:0,overdue:0,dueSoon:0,byDepartment:{},byStatus:{},averageRating:0};let s=0;return a.forEach(r=>{const t=(r.risk_level||"").toLowerCase();t==="critical"?e.critical++:t==="high"?e.high++:t==="medium"?e.medium++:t==="low"&&e.low++,r.review_status==="Overdue"?e.overdue++:r.review_status==="Due Soon"&&e.dueSoon++;const o=r.department||"Unassigned";e.byDepartment[o]=(e.byDepartment[o]||0)+1;const l=r.status||"Unknown";e.byStatus[l]=(e.byStatus[l]||0)+1,s+=r.overall_rating||0}),e.averageRating=e.total>0?(s/e.total).toFixed(1):0,e},getRiskMatrix:a=>{const e=Array(5).fill(null).map(()=>Array(5).fill(0)),s=Array(5).fill(null).map(()=>Array(5).fill(null).map(()=>[]));return a.forEach(r=>{const t=(r.likelihood||1)-1,o=(r.impact||1)-1;t>=0&&t<5&&o>=0&&o<5&&(e[4-o][t]++,s[4-o][t].push(r))}),{matrix:e,risksByCell:s}},addRiskReview:async(a,e)=>{c.value=!0,n.value=null;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.add_risk_review",{risk_name:a,review_date:e.review_date,reviewed_by:e.reviewed_by,summary:e.summary,actions:e.actions,next_review_date:e.next_review_date})).data.message||{}}catch(s){return n.value=s.message||"Failed to add review",console.error("API Error:",s),{success:!1,message:n.value}}finally{c.value=!1}},updateRiskReview:async(a,e,s)=>{c.value=!0,n.value=null;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.update_risk_review",{risk_name:a,review_idx:e,review_date:s.review_date,reviewed_by:s.reviewed_by,summary:s.summary,actions:s.actions,next_review_date:s.next_review_date})).data.message||{}}catch(r){return n.value=r.message||"Failed to update review",console.error("API Error:",r),{success:!1,message:n.value}}finally{c.value=!1}},deleteRiskReview:async(a,e)=>{c.value=!0,n.value=null;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.delete_risk_review",{risk_name:a,review_idx:e})).data.message||{}}catch(s){return n.value=s.message||"Failed to delete review",console.error("API Error:",s),{success:!1,message:n.value}}finally{c.value=!1}},getUserRoles:async()=>{try{return(await i.get("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.get_user_roles")).data.message||{is_any_approver:!1,is_global_approver:!1,roles:[]}}catch{return{is_any_approver:!1,is_global_approver:!1,roles:[]}}},canApproveRisk:async a=>{try{return(await i.get("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.can_approve_risk",{params:{risk_name:a}})).data.message||{can_approve:!1,status:""}}catch{return{can_approve:!1,status:""}}},submitForApproval:async a=>{var e,s;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.submit_for_approval",{risk_name:a})).data.message||{success:!1}}catch(r){return{success:!1,message:((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to submit for approval."}}},requestClose:async a=>{var e,s;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.request_close",{risk_name:a})).data.message||{success:!1}}catch(r){return{success:!1,message:((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to request closure."}}},approveRisk:async a=>{var e,s;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.approve_risk",{risk_name:a})).data.message||{success:!1}}catch(r){return{success:!1,message:((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to approve risk."}}},rejectRisk:async(a,e)=>{var s,r;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.reject_risk",{risk_name:a,reason:e||""})).data.message||{success:!1}}catch(t){return{success:!1,message:((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to reject risk."}}},getDepartments:async()=>{try{return(await i.get("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.get_departments")).data.message||[]}catch{return[]}},createDepartment:async a=>{var e,s;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.create_department",{department_name:a})).data.message||{success:!1}}catch(r){return{success:!1,message:((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to create department."}}},deleteDepartment:async a=>{var e,s;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.delete_department",{name:a})).data.message||{success:!1}}catch(r){return{success:!1,message:((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to delete department."}}},createUnit:async(a,e)=>{var s,r;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.create_unit",{unit_name:a,department:e})).data.message||{success:!1}}catch(t){return{success:!1,message:((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to create unit."}}},deleteUnit:async a=>{var e,s;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.delete_unit",{name:a})).data.message||{success:!1}}catch(r){return{success:!1,message:((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to delete unit."}}},getUsers:async()=>{try{return(await i.get("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.get_users")).data.message||[]}catch{return[]}},createUser:async(a,e,s,r)=>{var t,o;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.create_user",{email:a,first_name:e,last_name:s,roles:JSON.stringify(r)})).data.message||{success:!1}}catch(l){return{success:!1,message:((o=(t=l.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to create user."}}},updateUserRoles:async(a,e)=>{var s,r;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.update_user_roles",{user:a,roles:JSON.stringify(e)})).data.message||{success:!1}}catch(t){return{success:!1,message:((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to update roles."}}},toggleUserEnabled:async(a,e)=>{var s,r;try{return(await i.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.toggle_user_enabled",{user:a,enabled:e?1:0})).data.message||{success:!1}}catch(t){return{success:!1,message:((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to toggle user."}}},getAdminMeta:async()=>{try{return(await i.get("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.get_admin_meta")).data.message||{is_system_manager:!1,krcs_roles:[]}}catch{return{is_system_manager:!1,krcs_roles:[]}}}}}export{O as u};
