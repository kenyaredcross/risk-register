import{h as b,o as a,b as r,d as e,t as o,x as N,z as h,A as _,g as x,q as V,u as z,v as l,n as R,F as A,s as M,e as S,j as q,C as L,y as U,i as D}from"./vue-vendor-CW2bKMlP.js";import{u as F,a as I}from"./riskStore-B5-mWTZJ.js";const E={class:"bg-white rounded-lg shadow-elegant-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto animate-scale-in"},T={class:"sticky top-0 bg-white border-b border-light-border px-6 py-4 flex items-center justify-between"},H={class:"text-xl font-bold text-charcoal"},O={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},P={key:0,class:"p-4 bg-red-light rounded-lg"},Q={class:"text-sm text-red-dark"},G={class:"flex items-center justify-end space-x-3 pt-4 border-t border-light-border"},J=["disabled"],K={key:0},W={key:1},X={__name:"ReviewForm",props:{review:{type:Object,default:null},reviewIndex:{type:Number,default:null}},emits:["close","submit"],setup(B,{emit:j}){var C,$,g,y,f;const c=B,i=j,w=V(()=>c.review!==null),d=b({review_date:((C=c.review)==null?void 0:C.review_date)||"",reviewed_by:(($=c.review)==null?void 0:$.reviewed_by)||"",summary:((g=c.review)==null?void 0:g.summary)||"",actions:((y=c.review)==null?void 0:y.actions)||"",next_review_date:((f=c.review)==null?void 0:f.next_review_date)||""}),m=b(!1),v=b(""),p=async()=>{m.value=!0,v.value="";try{i("submit",{data:d.value,index:c.reviewIndex})}catch(k){v.value=k.message||"Failed to save review"}finally{m.value=!1}};return(k,s)=>(a(),r("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:s[7]||(s[7]=N(t=>k.$emit("close"),["self"]))},[e("div",E,[e("div",T,[e("h2",H,o(w.value?"Edit Review":"Add New Review"),1),e("button",{onClick:s[0]||(s[0]=t=>k.$emit("close")),class:"text-medium-gray hover:text-charcoal"},[...s[8]||(s[8]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:N(p,["prevent"]),class:"p-6 space-y-6"},[e("div",O,[e("div",null,[s[9]||(s[9]=e("label",{class:"block text-sm font-medium text-charcoal mb-2"},"Review Date *",-1)),h(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>d.value.review_date=t),type:"date",required:"",class:"input"},null,512),[[_,d.value.review_date]])]),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium text-charcoal mb-2"},"Reviewed By *",-1)),h(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>d.value.reviewed_by=t),type:"text",required:"",placeholder:"Enter reviewer name",class:"input"},null,512),[[_,d.value.reviewed_by]])])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-sm font-medium text-charcoal mb-2"},"Summary of Review *",-1)),h(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=t=>d.value.summary=t),required:"",rows:"4",placeholder:"Describe what was reviewed and key findings...",class:"input resize-none"},null,512),[[_,d.value.summary]])]),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium text-charcoal mb-2"},"Decisions / Actions Agreed *",-1)),h(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=t=>d.value.actions=t),required:"",rows:"4",placeholder:"List actions and decisions made during this review...",class:"input resize-none"},null,512),[[_,d.value.actions]])]),e("div",null,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium text-charcoal mb-2"},"Next Review Date",-1)),h(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>d.value.next_review_date=t),type:"date",class:"input"},null,512),[[_,d.value.next_review_date]])]),v.value?(a(),r("div",P,[e("p",Q,o(v.value),1)])):x("",!0),e("div",G,[e("button",{type:"button",onClick:s[6]||(s[6]=t=>k.$emit("close")),class:"btn btn-outline"}," Cancel "),e("button",{type:"submit",disabled:m.value,class:"btn btn-primary"},[m.value?(a(),r("span",K,"Saving...")):(a(),r("span",W,o(w.value?"Update Review":"Add Review"),1))],8,J)])],32)])]))}},Y={class:"animate-fade-in"},Z={key:0,class:"flex items-center justify-center py-20"},ee={key:1},te={class:"mb-6"},se={class:"flex items-start justify-between"},ie={class:"text-3xl font-bold text-charcoal mb-2"},le={class:"text-medium-gray"},oe={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ne={class:"lg:col-span-2 space-y-6"},ae={class:"card"},re={class:"text-charcoal"},de={class:"card"},ue={class:"grid grid-cols-3 gap-6"},ce={class:"text-center p-4 bg-light-gray rounded-lg"},me={class:"text-4xl font-bold text-charcoal"},ve={class:"text-center p-4 bg-light-gray rounded-lg"},xe={class:"text-4xl font-bold text-charcoal"},pe={key:0,class:"card"},ke={class:"space-y-2"},ge={class:"text-charcoal"},be={key:1,class:"card"},we={class:"space-y-2"},ye={class:"text-charcoal"},fe={key:2,class:"card"},he={class:"space-y-3"},_e={class:"font-semibold text-charcoal mb-2"},Re={class:"grid grid-cols-2 gap-4 text-sm"},Ce={class:"ml-2 text-charcoal"},$e={class:"ml-2 text-charcoal"},Ae={class:"card"},Me={class:"flex items-center justify-between mb-6"},je={key:0,class:"relative"},Be={class:"space-y-8"},Ne={class:"bg-light-gray rounded-lg p-4 hover:shadow-md transition-shadow"},De={class:"flex items-start justify-between mb-3"},Ve={class:"font-bold text-charcoal text-lg"},ze={class:"text-sm text-medium-gray flex items-center mt-1"},Se=["onClick"],qe={key:0,class:"mb-3"},Le={class:"text-sm text-charcoal whitespace-pre-wrap leading-relaxed"},Ue={key:1,class:"mb-3"},Fe={class:"text-sm text-charcoal whitespace-pre-wrap leading-relaxed"},Ie={key:2,class:"flex items-center text-xs text-medium-gray mt-3 pt-3 border-t border-white"},Ee={key:1,class:"text-center py-12 text-medium-gray"},Te={class:"space-y-6"},He={class:"card"},Oe={class:"space-y-4"},Pe={class:"text-charcoal font-medium"},Qe={class:"text-charcoal font-medium"},Ge={class:"text-charcoal font-medium"},Je={class:"text-charcoal font-medium"},Ke={class:"badge badge-medium"},We={class:"text-charcoal font-medium"},Xe={class:"card"},Ye={class:"space-y-3"},Ze={class:"text-sm text-charcoal"},et={class:"text-sm text-charcoal"},tt={class:"card"},st={class:"space-y-2"},it=["href"],lt={key:2,class:"card text-center py-12"},rt={__name:"RiskDetail",setup(B){const j=L(),c=U(),i=F(),w=I(),d=b(!1),m=b(null),v=b(null),p=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A",C=s=>({low:"badge-low",medium:"badge-medium",high:"badge-high",critical:"badge-critical"})[(s||"").toLowerCase()]||"badge-medium",$=s=>s>=15?"bg-red-light":s>=10?"bg-orange-100":s>=5?"bg-yellow-100":"bg-green-100",g=s=>s>=15?"text-red-dark":s>=10?"text-orange-800":s>=5?"text-yellow-800":"text-green-800",y=(s=null,t=null)=>{m.value=s,v.value=t,d.value=!0},f=()=>{d.value=!1,m.value=null,v.value=null},k=async({data:s,index:t})=>{const n=i.selectedRisk.name;let u;t!==null?u=await w.updateRiskReview(n,t,s):u=await w.addRiskReview(n,s),u.success?(await i.loadRisk(n),f()):alert(u.message||"Failed to save review")};return z(()=>{const s=j.params.id;i.loadRisk(s)}),(s,t)=>(a(),r("div",Y,[l(i).loading?(a(),r("div",Z,[...t[4]||(t[4]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-primary"},null,-1)])])):l(i).selectedRisk?(a(),r("div",ee,[e("div",te,[e("button",{onClick:t[0]||(t[0]=n=>l(c).back()),class:"text-medium-gray hover:text-charcoal mb-4 flex items-center space-x-2"},[...t[5]||(t[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),e("span",null,"Back",-1)])]),e("div",se,[e("div",null,[e("h1",ie,o(l(i).selectedRisk.name),1),e("p",le,o(p(l(i).selectedRisk.creation)),1)]),e("span",{class:R(["badge text-base px-4 py-2",C(l(i).selectedRisk.risk_level)])},o(l(i).selectedRisk.risk_level||"Unknown"),3)])]),e("div",oe,[e("div",ne,[e("div",ae,[t[6]||(t[6]=e("h2",{class:"card-header"},"Risk Description",-1)),e("p",re,o(l(i).selectedRisk.risk_description||"No description available"),1)]),e("div",de,[t[11]||(t[11]=e("h2",{class:"card-header"},"Risk Assessment",-1)),e("div",ue,[e("div",ce,[t[7]||(t[7]=e("div",{class:"text-sm text-medium-gray mb-2"},"Likelihood",-1)),e("div",me,o(l(i).selectedRisk.likelihood||0),1),t[8]||(t[8]=e("div",{class:"text-xs text-medium-gray mt-1"},"out of 5",-1))]),e("div",ve,[t[9]||(t[9]=e("div",{class:"text-sm text-medium-gray mb-2"},"Impact",-1)),e("div",xe,o(l(i).selectedRisk.impact||0),1),t[10]||(t[10]=e("div",{class:"text-xs text-medium-gray mt-1"},"out of 5",-1))]),e("div",{class:R(["text-center p-4 rounded-lg",$(l(i).selectedRisk.overall_rating)])},[e("div",{class:R(["text-sm mb-2",g(l(i).selectedRisk.overall_rating)])},"Overall Rating",2),e("div",{class:R(["text-4xl font-bold",g(l(i).selectedRisk.overall_rating)])},o(l(i).selectedRisk.overall_rating||0),3),e("div",{class:R(["text-xs mt-1",g(l(i).selectedRisk.overall_rating)])},"Likelihood Ã— Impact",2)],2)])]),l(i).selectedRisk.possible_causes&&l(i).selectedRisk.possible_causes.length>0?(a(),r("div",pe,[t[13]||(t[13]=e("h2",{class:"card-header"},"Possible Causes",-1)),e("ul",ke,[(a(!0),r(A,null,M(l(i).selectedRisk.possible_causes,(n,u)=>(a(),r("li",{key:u,class:"flex items-start space-x-2"},[t[12]||(t[12]=e("svg",{class:"w-5 h-5 text-red-primary mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)),e("span",ge,o(n.cause),1)]))),128))])])):x("",!0),l(i).selectedRisk.risk_consequences&&l(i).selectedRisk.risk_consequences.length>0?(a(),r("div",be,[t[15]||(t[15]=e("h2",{class:"card-header"},"Risk Consequences",-1)),e("ul",we,[(a(!0),r(A,null,M(l(i).selectedRisk.risk_consequences,(n,u)=>(a(),r("li",{key:u,class:"flex items-start space-x-2"},[t[14]||(t[14]=e("svg",{class:"w-5 h-5 text-red-primary mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",ye,o(n.effect),1)]))),128))])])):x("",!0),l(i).selectedRisk.mitigating_actions&&l(i).selectedRisk.mitigating_actions.length>0?(a(),r("div",fe,[t[18]||(t[18]=e("h2",{class:"card-header"},"Mitigating Actions",-1)),e("div",he,[(a(!0),r(A,null,M(l(i).selectedRisk.mitigating_actions,(n,u)=>(a(),r("div",{key:u,class:"p-4 bg-light-gray rounded-lg"},[e("div",_e,o(n.action),1),e("div",Re,[e("div",null,[t[16]||(t[16]=e("span",{class:"text-medium-gray"},"Responsibility:",-1)),e("span",Ce,o(n.responsibility||"N/A"),1)]),e("div",null,[t[17]||(t[17]=e("span",{class:"text-medium-gray"},"Timeline:",-1)),e("span",$e,o(n.timeline||"N/A"),1)])])]))),128))])])):x("",!0),e("div",Ae,[e("div",Me,[t[19]||(t[19]=e("h2",{class:"card-header mb-0"},"Risk Reviews",-1)),e("button",{onClick:t[1]||(t[1]=n=>y()),class:"btn btn-danger text-sm"}," Add Review ")]),l(i).selectedRisk.risk_reviews&&l(i).selectedRisk.risk_reviews.length>0?(a(),r("div",je,[t[26]||(t[26]=e("div",{class:"absolute left-4 top-0 bottom-0 w-0.5 bg-light-gray"},null,-1)),e("div",Be,[(a(!0),r(A,null,M(l(i).selectedRisk.risk_reviews,(n,u)=>(a(),r("div",{key:u,class:"relative pl-12"},[t[25]||(t[25]=e("div",{class:"absolute left-2.5 top-1 w-3 h-3 rounded-full bg-red-primary ring-4 ring-white"},null,-1)),e("div",Ne,[e("div",De,[e("div",null,[e("div",Ve,o(p(n.review_date)),1),e("div",ze,[t[20]||(t[20]=e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),D(" "+o(n.reviewed_by),1)])]),e("button",{onClick:ot=>y(n,u),class:"text-medium-gray hover:text-red-primary transition-colors",title:"Edit"},[...t[21]||(t[21]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Se)]),n.summary?(a(),r("div",qe,[t[22]||(t[22]=e("div",{class:"text-xs font-bold text-medium-gray uppercase tracking-wide mb-1"},"Summary",-1)),e("div",Le,o(n.summary),1)])):x("",!0),n.actions?(a(),r("div",Ue,[t[23]||(t[23]=e("div",{class:"text-xs font-bold text-medium-gray uppercase tracking-wide mb-1"},"Actions Agreed",-1)),e("div",Fe,o(n.actions),1)])):x("",!0),n.next_review_date?(a(),r("div",Ie,[t[24]||(t[24]=e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),D(" Next Review: "+o(p(n.next_review_date)),1)])):x("",!0)])]))),128))])])):(a(),r("div",Ee,[...t[27]||(t[27]=[S('<div class="w-16 h-16 mx-auto mb-4 rounded-full bg-light-gray flex items-center justify-center"><svg class="w-8 h-8 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><p class="font-medium">No reviews yet</p><p class="text-sm mt-1">Click &quot;Add Review&quot; to create the first review</p>',3)])]))])]),e("div",Te,[e("div",He,[t[34]||(t[34]=e("h2",{class:"card-header"},"Quick Info",-1)),e("div",Oe,[e("div",null,[t[28]||(t[28]=e("div",{class:"text-xs text-medium-gray mb-1"},"Risk Owner",-1)),e("div",Pe,o(l(i).selectedRisk.risk_owner||"Unassigned"),1)]),e("div",null,[t[29]||(t[29]=e("div",{class:"text-xs text-medium-gray mb-1"},"Department",-1)),e("div",Qe,o(l(i).selectedRisk.department||"N/A"),1)]),e("div",null,[t[30]||(t[30]=e("div",{class:"text-xs text-medium-gray mb-1"},"Unit",-1)),e("div",Ge,o(l(i).selectedRisk.unit||"N/A"),1)]),e("div",null,[t[31]||(t[31]=e("div",{class:"text-xs text-medium-gray mb-1"},"County",-1)),e("div",Je,o(l(i).selectedRisk.county||"N/A"),1)]),e("div",null,[t[32]||(t[32]=e("div",{class:"text-xs text-medium-gray mb-1"},"Status",-1)),e("span",Ke,o(l(i).selectedRisk.status||"Unknown"),1)]),e("div",null,[t[33]||(t[33]=e("div",{class:"text-xs text-medium-gray mb-1"},"Timeline",-1)),e("div",We,o(l(i).selectedRisk.timeline||"N/A"),1)])])]),e("div",Xe,[t[37]||(t[37]=e("h2",{class:"card-header"},"Timeline",-1)),e("div",Ye,[e("div",null,[t[35]||(t[35]=e("div",{class:"text-xs text-medium-gray mb-1"},"Created",-1)),e("div",Ze,o(p(l(i).selectedRisk.creation)),1)]),e("div",null,[t[36]||(t[36]=e("div",{class:"text-xs text-medium-gray mb-1"},"Last Modified",-1)),e("div",et,o(p(l(i).selectedRisk.modified)),1)])])]),e("div",tt,[t[38]||(t[38]=e("h2",{class:"card-header"},"Actions",-1)),e("div",st,[e("a",{href:`/app/program-risk-register/${l(i).selectedRisk.name}`,target:"_blank",class:"btn btn-primary w-full block text-center"}," Edit in Frappe ",8,it),e("button",{onClick:t[2]||(t[2]=n=>l(c).push("/risks")),class:"btn btn-outline w-full"}," View All Risks ")])])])])])):(a(),r("div",lt,[t[39]||(t[39]=e("svg",{class:"w-16 h-16 text-medium-gray mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t[40]||(t[40]=e("p",{class:"text-medium-gray mb-4"},"Risk not found",-1)),e("button",{onClick:t[3]||(t[3]=n=>l(c).push("/risks")),class:"btn btn-outline"}," Back to Risk Register ")])),d.value?(a(),q(X,{key:3,review:m.value,"review-index":v.value,onClose:f,onSubmit:k},null,8,["review","review-index"])):x("",!0)]))}};export{rt as default};
