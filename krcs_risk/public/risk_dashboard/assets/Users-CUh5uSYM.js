import{E as I,o as a,e as o,f as e,h as D,w as R,m as _,n as h,F as b,C as f,j as y,v as j,x as p,y as A,G as B,t as r,k as P,r as d,I as K}from"./vue-vendor-Bo70p1Jw.js";import{u as q}from"./useApi-VH5eLdFx.js";import"./index-DMXc1wYA.js";const J={class:"animate-fade-in"},O={class:"mb-6 border-b border-light-border"},Q={class:"flex space-x-6"},W={class:"mb-6 flex items-center justify-between"},X={key:0,class:"flex items-center justify-center py-20"},Y={key:1,class:"card overflow-hidden"},Z={class:"overflow-x-auto"},ee={class:"w-full"},te={class:"divide-y divide-light-border"},se={class:"px-4 py-3 text-sm text-charcoal font-medium"},le={class:"px-4 py-3 text-sm text-medium-gray"},ae={class:"px-4 py-3 text-sm text-medium-gray"},oe={class:"px-4 py-3"},ne={class:"px-4 py-3"},re={class:"flex flex-wrap gap-1"},ie={key:0,class:"text-xs text-medium-gray"},de={class:"px-4 py-3 text-right"},ue=["onClick"],me=["onClick"],ce={key:0,class:"text-center py-12 text-medium-gray"},pe={class:"bg-white rounded-lg shadow-elegant-xl max-w-lg w-full p-6"},xe={class:"space-y-4 mb-4"},ve=["value"],be={class:"grid grid-cols-2 gap-2"},fe=["value"],ye={key:0,class:"text-sm text-red-600 mb-3"},ge={class:"flex space-x-3"},he=["disabled"],ke={class:"bg-white rounded-lg shadow-elegant-xl max-w-lg w-full p-6"},_e={class:"text-sm text-medium-gray mb-4"},we={class:"space-y-4 mb-4"},Ce=["value"],Ue={class:"grid grid-cols-2 gap-2"},Ne=["value"],Me={key:0,class:"text-sm text-red-600 mb-3"},Ee={class:"flex space-x-3"},Se=["disabled"],$e={__name:"Users",setup(Ve){const g=q(),w=d([]),C=d([]),U=d([]),N=d(!1),u=d(!1),i=d(""),M=d(!1),n=d({email:"",firstName:"",lastName:"",department:"",roles:[]}),E=d(!1),x=d(null),m=d({department:"",roles:[]}),k=async()=>{N.value=!0,w.value=await g.getUsers(),N.value=!1},z=async()=>{const l=await g.getAdminMeta();C.value=l.krcs_roles||[],U.value=l.departments||[]},S=()=>{M.value=!1,n.value={email:"",firstName:"",lastName:"",department:"",roles:[]},i.value=""},L=async()=>{if(!n.value.email||!n.value.firstName)return;u.value=!0,i.value="";const l=await g.createUser(n.value.email,n.value.firstName,n.value.lastName,n.value.department,n.value.roles);u.value=!1,l.success?(S(),await k()):i.value=l.message||"Failed to create user"},T=l=>{x.value=l,m.value.department=l.krcs_department||"",m.value.roles=[...l.krcs_roles],E.value=!0,i.value=""},V=()=>{E.value=!1,x.value=null,m.value={department:"",roles:[]},i.value=""},G=async()=>{if(!x.value)return;u.value=!0,i.value="";const l=await g.updateUser(x.value.name,m.value.department,m.value.roles);u.value=!1,l.success?(V(),await k()):i.value=l.message||"Failed to update user"},H=async l=>{const t=l.enabled?"disable":"enable";if(!confirm(`${t.charAt(0).toUpperCase()+t.slice(1)} user "${l.full_name||l.email}"?`))return;u.value=!0,i.value="";const v=await g.toggleUserEnabled(l.name,!l.enabled);u.value=!1,v.success?await k():i.value=v.message||`Failed to ${t} user`};return I(async()=>{await Promise.all([k(),z()])}),(l,t)=>{var $,F;const v=P("router-link");return a(),o("div",J,[t[26]||(t[26]=e("div",{class:"mb-6"},[e("h1",{class:"text-3xl font-bold text-charcoal mb-2"},"Administration"),e("p",{class:"text-medium-gray"},"Manage departments, users, and roles")],-1)),e("div",O,[e("nav",Q,[D(v,{to:"/admin/departments",class:h(["pb-3 px-1 border-b-2 font-medium text-sm transition-colors",l.$route.path==="/admin/departments"?"border-red-primary text-red-primary":"border-transparent text-medium-gray hover:text-charcoal hover:border-light-border"])},{default:R(()=>[...t[8]||(t[8]=[_(" Departments & Units ",-1)])]),_:1},8,["class"]),D(v,{to:"/admin/users",class:h(["pb-3 px-1 border-b-2 font-medium text-sm transition-colors",l.$route.path==="/admin/users"?"border-red-primary text-red-primary":"border-transparent text-medium-gray hover:text-charcoal hover:border-light-border"])},{default:R(()=>[...t[9]||(t[9]=[_(" Users ",-1)])]),_:1},8,["class"]),D(v,{to:"/admin/roles",class:h(["pb-3 px-1 border-b-2 font-medium text-sm transition-colors",l.$route.path==="/admin/roles"?"border-red-primary text-red-primary":"border-transparent text-medium-gray hover:text-charcoal hover:border-light-border"])},{default:R(()=>[...t[10]||(t[10]=[_(" Roles Reference ",-1)])]),_:1},8,["class"])])]),e("div",W,[t[12]||(t[12]=e("div",null,[e("h2",{class:"text-xl font-bold text-charcoal mb-1"},"User Management"),e("p",{class:"text-sm text-medium-gray"},"Manage users and their KRCS roles")],-1)),e("button",{onClick:t[0]||(t[0]=s=>M.value=!0),class:"btn btn-primary"},[...t[11]||(t[11]=[e("svg",{class:"w-5 h-5 inline mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),_(" Add User ",-1)])])]),N.value?(a(),o("div",X,[...t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-primary"},null,-1)])])):(a(),o("div",Y,[e("div",Z,[e("table",ee,[t[14]||(t[14]=e("thead",{class:"bg-light-gray"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Name"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Email"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Department"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"KRCS Roles"),e("th",{class:"px-4 py-3 text-right text-xs font-semibold text-charcoal uppercase"},"Actions")])],-1)),e("tbody",te,[(a(!0),o(b,null,f(w.value,s=>(a(),o("tr",{key:s.name,class:"hover:bg-off-white transition-colors"},[e("td",se,r(s.full_name||s.name),1),e("td",le,r(s.email),1),e("td",ae,r(s.department_name||"-"),1),e("td",oe,[e("span",{class:h(["px-2 py-1 rounded-full text-xs font-semibold",s.enabled?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"])},r(s.enabled?"Active":"Disabled"),3)]),e("td",ne,[e("div",re,[(a(!0),o(b,null,f(s.krcs_roles,c=>(a(),o("span",{key:c,class:"px-2 py-1 bg-red-light text-red-dark rounded text-xs font-medium"},r(c),1))),128)),s.krcs_roles.length===0?(a(),o("span",ie,"No roles")):y("",!0)])]),e("td",de,[e("button",{onClick:c=>T(s),class:"text-sm text-red-primary hover:text-red-dark font-medium mr-3"}," Edit ",8,ue),e("button",{onClick:c=>H(s),class:h(["text-sm hover:underline",s.enabled?"text-medium-gray":"text-green-600"])},r(s.enabled?"Disable":"Enable"),11,me)])]))),128))])])]),w.value.length===0?(a(),o("div",ce," No users found ")):y("",!0)])),M.value?(a(),o("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:j(S,["self"])},[e("div",pe,[t[21]||(t[21]=e("h3",{class:"text-lg font-bold text-charcoal mb-4"},"Create New User",-1)),e("div",xe,[e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-charcoal mb-1"},"Email *",-1)),p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.email=s),type:"email",class:"input w-full",placeholder:"user@redcross.or.ke"},null,512),[[A,n.value.email]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-charcoal mb-1"},"First Name *",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.firstName=s),type:"text",class:"input w-full"},null,512),[[A,n.value.firstName]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-charcoal mb-1"},"Last Name",-1)),p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.lastName=s),type:"text",class:"input w-full"},null,512),[[A,n.value.lastName]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-charcoal mb-1"},"Department",-1)),p(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>n.value.department=s),class:"input w-full"},[t[18]||(t[18]=e("option",{value:""},"Select Department",-1)),(a(!0),o(b,null,f(U.value,s=>(a(),o("option",{key:s.name,value:s.name},r(s.department_name),9,ve))),128))],512),[[B,n.value.department]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-charcoal mb-2"},"Assign KRCS Roles",-1)),e("div",be,[(a(!0),o(b,null,f(C.value,s=>(a(),o("label",{key:s,class:"flex items-center space-x-2 text-sm"},[p(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[5]||(t[5]=c=>n.value.roles=c),class:"rounded"},null,8,fe),[[K,n.value.roles]]),e("span",null,r(s),1)]))),128))])])]),i.value?(a(),o("div",ye,r(i.value),1)):y("",!0),e("div",ge,[e("button",{onClick:S,class:"btn btn-outline flex-1"},"Cancel"),e("button",{onClick:L,disabled:u.value||!n.value.email||!n.value.firstName,class:"btn btn-primary flex-1"},r(u.value?"Creating...":"Create User"),9,he)])])])):y("",!0),E.value?(a(),o("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:j(V,["self"])},[e("div",ke,[t[25]||(t[25]=e("h3",{class:"text-lg font-bold text-charcoal mb-1"},"Edit User",-1)),e("p",_e,r((($=x.value)==null?void 0:$.full_name)||((F=x.value)==null?void 0:F.email)),1),e("div",we,[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-charcoal mb-1"},"Department",-1)),p(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>m.value.department=s),class:"input w-full"},[t[22]||(t[22]=e("option",{value:""},"Select Department",-1)),(a(!0),o(b,null,f(U.value,s=>(a(),o("option",{key:s.name,value:s.name},r(s.department_name),9,Ce))),128))],512),[[B,m.value.department]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-charcoal mb-2"},"Assign KRCS Roles",-1)),e("div",Ue,[(a(!0),o(b,null,f(C.value,s=>(a(),o("label",{key:s,class:"flex items-center space-x-2 text-sm"},[p(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[7]||(t[7]=c=>m.value.roles=c),class:"rounded"},null,8,Ne),[[K,m.value.roles]]),e("span",null,r(s),1)]))),128))])])]),i.value?(a(),o("div",Me,r(i.value),1)):y("",!0),e("div",Ee,[e("button",{onClick:V,class:"btn btn-outline flex-1"},"Cancel"),e("button",{onClick:G,disabled:u.value,class:"btn btn-primary flex-1"},r(u.value?"Saving...":"Save Changes"),9,Se)])])])):y("",!0)])}}};export{$e as default};
