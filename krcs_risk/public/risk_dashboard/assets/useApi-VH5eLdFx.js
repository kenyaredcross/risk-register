import{a as n}from"./index-DMXc1wYA.js";import{r as p}from"./vue-vendor-Bo70p1Jw.js";function B(){const o=p(!1),i=p(null),u=async()=>{o.value=!0,i.value=null;try{return(await n.get("/api/resource/Program Risk Register",{params:{fields:JSON.stringify(["name","project","risk_category","risk_description","likelihood","impact","overall_rating","risk_level","risk_owner","department","region","status","review_frequency","next_review_due","review_status","timeline","status","approved_by","approval_date","rejection_reason","creation","modified"]),limit_page_length:0}})).data.data||[]}catch(r){return i.value=r.message||"Failed to fetch risks",console.error("API Error:",r),[]}finally{o.value=!1}},g=async r=>{o.value=!0,i.value=null;try{return(await n.get(`/api/resource/Program Risk Register/${r}`)).data.data||null}catch(e){return i.value=e.message||"Failed to fetch risk",console.error("API Error:",e),null}finally{o.value=!1}},d=r=>{const e={total:r.length,critical:0,high:0,medium:0,low:0,overdue:0,dueSoon:0,byDepartment:{},byStatus:{},averageRating:0};let s=0;return r.forEach(a=>{const t=(a.risk_level||"").toLowerCase();t==="critical"?e.critical++:t==="high"?e.high++:t==="medium"?e.medium++:t==="low"&&e.low++,a.review_status==="Overdue"?e.overdue++:a.review_status==="Due Soon"&&e.dueSoon++;const c=a.department||"Unassigned";e.byDepartment[c]=(e.byDepartment[c]||0)+1;const l=a.status||"Unknown";e.byStatus[l]=(e.byStatus[l]||0)+1,s+=a.overall_rating||0}),e.averageRating=e.total>0?(s/e.total).toFixed(1):0,e},k=r=>{const e=Array(5).fill(null).map(()=>Array(5).fill(0)),s=Array(5).fill(null).map(()=>Array(5).fill(null).map(()=>[]));return r.forEach(a=>{const t=(a.likelihood||1)-1,c=(a.impact||1)-1;t>=0&&t<5&&c>=0&&c<5&&(e[4-c][t]++,s[4-c][t].push(a))}),{matrix:e,risksByCell:s}},y=async(r,e)=>{o.value=!0,i.value=null;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.add_risk_review",{risk_name:r,review_date:e.review_date,reviewed_by:e.reviewed_by,summary:e.summary,actions:e.actions,next_review_date:e.next_review_date})).data.message||{}}catch(s){return i.value=s.message||"Failed to add review",console.error("API Error:",s),{success:!1,message:i.value}}finally{o.value=!1}},f=async(r,e,s)=>{o.value=!0,i.value=null;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.update_risk_review",{risk_name:r,review_idx:e,review_date:s.review_date,reviewed_by:s.reviewed_by,summary:s.summary,actions:s.actions,next_review_date:s.next_review_date})).data.message||{}}catch(a){return i.value=a.message||"Failed to update review",console.error("API Error:",a),{success:!1,message:i.value}}finally{o.value=!1}},v=async(r,e)=>{o.value=!0,i.value=null;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.delete_risk_review",{risk_name:r,review_idx:e})).data.message||{}}catch(s){return i.value=s.message||"Failed to delete review",console.error("API Error:",s),{success:!1,message:i.value}}finally{o.value=!1}},h=async()=>{try{return(await n.get("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.get_user_roles")).data.message||{is_any_approver:!1,is_global_approver:!1,roles:[]}}catch{return{is_any_approver:!1,is_global_approver:!1,roles:[]}}},w=async r=>{try{return(await n.get("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.can_approve_risk",{params:{risk_name:r}})).data.message||{can_approve:!1,status:""}}catch{return{can_approve:!1,status:""}}},R=async r=>{var e,s;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.submit_for_approval",{risk_name:r})).data.message||{success:!1}}catch(a){return{success:!1,message:((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to submit for approval."}}},b=async r=>{var e,s;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.request_close",{risk_name:r})).data.message||{success:!1}}catch(a){return{success:!1,message:((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to request closure."}}},F=async r=>{var e,s;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.approve_risk",{risk_name:r})).data.message||{success:!1}}catch(a){return{success:!1,message:((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to approve risk."}}},A=async(r,e)=>{var s,a;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.reject_risk",{risk_name:r,reason:e||""})).data.message||{success:!1}}catch(t){return{success:!1,message:((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to reject risk."}}},U=async()=>{try{return(await n.get("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.get_departments")).data.message||[]}catch{return[]}},x=async r=>{var e,s;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.create_department",{department_name:r})).data.message||{success:!1}}catch(a){return{success:!1,message:((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to create department."}}},S=async r=>{var e,s;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.delete_department",{name:r})).data.message||{success:!1}}catch(a){return{success:!1,message:((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to delete department."}}},E=async(r,e)=>{var s,a;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.create_unit",{unit_name:r,department:e})).data.message||{success:!1}}catch(t){return{success:!1,message:((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to create unit."}}},P=async r=>{var e,s;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.delete_unit",{name:r})).data.message||{success:!1}}catch(a){return{success:!1,message:((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to delete unit."}}},j=async()=>{try{return(await n.get("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.get_users")).data.message||[]}catch{return[]}},C=async(r,e,s,a,t)=>{var c,l;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.create_user",{email:r,first_name:e,last_name:s,department:a||null,roles:JSON.stringify(t)})).data.message||{success:!1}}catch(_){return{success:!1,message:((l=(c=_.response)==null?void 0:c.data)==null?void 0:l.message)||"Failed to create user."}}},m=async(r,e,s)=>{var a,t;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.update_user",{user:r,department:e||null,roles:JSON.stringify(s)})).data.message||{success:!1}}catch(c){return{success:!1,message:((t=(a=c.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to update user."}}};return{loading:o,error:i,fetchRisks:u,fetchRisk:g,getRiskStats:d,getRiskMatrix:k,addRiskReview:y,updateRiskReview:f,deleteRiskReview:v,getUserRoles:h,canApproveRisk:w,submitForApproval:R,requestClose:b,approveRisk:F,rejectRisk:A,getDepartments:U,createDepartment:x,deleteDepartment:S,createUnit:E,deleteUnit:P,getUsers:j,createUser:C,updateUser:m,updateUserRoles:async(r,e)=>m(r,null,e),toggleUserEnabled:async(r,e)=>{var s,a;try{return(await n.post("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.toggle_user_enabled",{user:r,enabled:e?1:0})).data.message||{success:!1}}catch(t){return{success:!1,message:((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to toggle user."}}},getAdminMeta:async()=>{try{return(await n.get("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.get_admin_meta")).data.message||{is_system_manager:!1,krcs_roles:[]}}catch{return{is_system_manager:!1,krcs_roles:[]}}},getCurrentUser:async()=>{try{return(await n.get("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.get_current_user")).data.message||null}catch(r){return console.error("Failed to get current user:",r),null}}}}export{B as u};
