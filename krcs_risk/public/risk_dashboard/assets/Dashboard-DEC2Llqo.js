import{o as i,e as a,f as e,B as E,n as h,t as d,j as R,c as C,F as b,C as y,D as G,E as P,x as H,G as N,u as S,h as _,w as M,m as L,v as J,r as D,k as K,A as Q,i as W}from"./vue-vendor-Bo70p1Jw.js";import{u as X}from"./riskStore-B9zyg5fM.js";import{_ as U,a as Y}from"./index-DMXc1wYA.js";import{R as Z}from"./RiskCard-u9OTqdrZ.js";import"./useApi-VH5eLdFx.js";const I={class:"stat-label"},ee={key:0,class:"text-xs text-medium-gray mt-1"},j={__name:"StatsCard",props:{value:{type:[String,Number],required:!0},label:{type:String,required:!0},subtitle:{type:String,default:""},variant:{type:String,default:"default",validator:p=>["default","critical","high","medium","low"].includes(p)},delay:{type:Number,default:0}},setup(p){const x=p,w=C(()=>({default:"bg-charcoal",critical:"bg-red-primary",high:"bg-orange-500",medium:"bg-yellow-500",low:"bg-green-500"})[x.variant]),g=C(()=>"text-white"),f=C(()=>({default:"text-charcoal",critical:"text-red-primary",high:"text-orange-600",medium:"text-yellow-600",low:"text-green-600"})[x.variant]),m=C(()=>({0:"",100:"animate-delay-100",200:"animate-delay-200",300:"animate-delay-300",400:"animate-delay-400"})[x.delay]||"");return(u,$)=>(i(),a("div",{class:h(["stat-card animate-slide-up",m.value])},[e("div",{class:h(["w-12 h-12 rounded-full flex items-center justify-center mb-3",w.value])},[E(u.$slots,"icon",{},()=>[(i(),a("svg",{class:h(["w-6 h-6",g.value]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...$[0]||($[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])],2))])],2),e("div",{class:h(["stat-value",f.value])},d(p.value),3),e("div",I,d(p.label),1),p.subtitle?(i(),a("div",ee,d(p.subtitle),1)):R("",!0)],2))}},te={class:"card"},se={class:"overflow-x-auto"},le={class:"inline-block min-w-full"},ie={class:"flex"},ae={class:"flex-1"},oe={class:"flex mb-2"},re={class:"flex-1 grid grid-cols-5 gap-2 text-center"},ne={class:"space-y-2"},de={class:"w-12 flex items-center justify-center text-xs font-semibold text-medium-gray"},ue={class:"flex-1 grid grid-cols-5 gap-2"},ce=["onClick","title"],me={class:"flex mt-2"},ve={class:"flex-1 grid grid-cols-5 gap-2 text-center"},pe={class:"mt-6 flex flex-wrap gap-4 justify-center"},xe={class:"text-sm font-medium"},he={__name:"RiskMatrix",props:{matrix:{type:Array,required:!0},risksByCell:{type:Array,default:()=>[]}},emits:["cell-click"],setup(p,{emit:x}){const w=p,g=x,f=[{label:"Low (1-4)",class:"bg-risk-low"},{label:"Medium (5-9)",class:"bg-risk-medium"},{label:"High (10-14)",class:"bg-risk-high"},{label:"Critical (15-25)",class:"bg-risk-critical"}],m=(v,r)=>{const o=5-v,n=r+1;return o*n},u=(v,r)=>{const o=m(v,r),n=w.matrix[v][r];let c="";o>=1&&o<=4?c="bg-risk-low":o>=5&&o<=9?c="bg-risk-medium":o>=10&&o<=14?c="bg-risk-high":o>=15&&(c="bg-risk-critical");const k=n>0&&o>=15?"animate-pulse-red shadow-red-glow":"";return`${c} ${k} ${n>0?"opacity-100":"opacity-40"}`},$=(v,r,o)=>{const n=5-v,c=r+1,k=n*c;return`Likelihood: ${c}, Impact: ${n}
Rating: ${k}
Risks: ${o}`},V=(v,r)=>{if(w.risksByCell&&w.risksByCell[v]&&w.risksByCell[v][r]){const o=w.risksByCell[v][r];g("cell-click",{rowIndex:v,colIndex:r,risks:o})}};return(v,r)=>(i(),a("div",te,[r[4]||(r[4]=e("h2",{class:"card-header flex items-center justify-between"},[e("span",null,"Risk Matrix"),e("span",{class:"text-sm font-normal text-medium-gray"},"Likelihood Ã— Impact")],-1)),e("div",se,[e("div",le,[e("div",ie,[r[3]||(r[3]=e("div",{class:"flex flex-col justify-center pr-4"},[e("div",{class:"writing-mode-vertical text-sm font-semibold text-medium-gray uppercase tracking-wide"}," Impact ")],-1)),e("div",ae,[e("div",oe,[r[0]||(r[0]=e("div",{class:"w-12"},null,-1)),e("div",re,[(i(),a(b,null,y(5,o=>e("div",{key:`impact-${o}`,class:"text-xs font-semibold text-medium-gray"},d(6-o),1)),64))])]),e("div",ne,[(i(!0),a(b,null,y(p.matrix,(o,n)=>(i(),a("div",{key:`row-${n}`,class:"flex gap-2"},[e("div",de,d(5-n),1),e("div",ue,[(i(!0),a(b,null,y(o,(c,k)=>(i(),a("div",{key:`cell-${n}-${k}`,onClick:z=>V(n,k),class:h(["aspect-square flex items-center justify-center rounded-lg cursor-pointer transition-all duration-200 hover:scale-105",u(n,k)]),title:$(n,k,c)},[e("span",{class:h(["text-lg font-bold",c>0?"text-white":"text-gray-400"])},d(c||"0"),3)],10,ce))),128))])]))),128))]),e("div",me,[r[1]||(r[1]=e("div",{class:"w-12"},null,-1)),e("div",ve,[(i(),a(b,null,y(5,o=>e("div",{key:`likelihood-${o}`,class:"text-xs font-semibold text-medium-gray"},d(o),1)),64))])]),r[2]||(r[2]=e("div",{class:"text-center mt-4"},[e("div",{class:"text-sm font-semibold text-medium-gray uppercase tracking-wide"}," Likelihood ")],-1))])]),e("div",pe,[(i(),a(b,null,y(f,o=>e("div",{key:o.label,class:"flex items-center space-x-2"},[e("div",{class:h(["w-4 h-4 rounded",o.class])},null,2),e("span",xe,d(o.label),1)])),64))])])])]))}},ge=U(he,[["__scopeId","data-v-6b34dbb4"]]),fe={class:"animate-fade-in"},ke={class:"card mb-6"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ye=["value"],we=["disabled"],_e=["value"],Ce={key:0,class:"mt-4 pt-4 border-t border-light-border flex items-center justify-between"},$e={class:"flex items-center flex-wrap gap-2"},Me={key:0,class:"badge badge-medium"},Re={key:1,class:"badge badge-medium"},Be={key:0,class:"flex items-center justify-center py-20"},je={key:1},De={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-7 gap-6 mb-8"},Ve={class:"mb-8 animate-scale-in"},ze={class:"animate-slide-up"},Se={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6"},Le={class:"flex flex-wrap items-center gap-3"},Ae={class:"inline-flex items-center bg-light-gray rounded-lg p-1 border border-light-border"},He={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Ne={key:1,class:"card overflow-hidden"},Ue={class:"overflow-x-auto"},Fe={class:"w-full"},Te={class:"divide-y divide-light-border"},Oe={class:"px-4 py-3 text-sm font-medium text-charcoal"},qe={class:"px-4 py-3 text-sm text-medium-gray"},Ee={class:"line-clamp-2"},Ge={class:"px-4 py-3 text-sm text-medium-gray"},Pe={class:"px-4 py-3"},Je={class:"px-4 py-3 text-sm font-medium text-charcoal"},Ke={class:"px-4 py-3 text-sm text-medium-gray"},Qe={class:"px-4 py-3"},We={class:"px-4 py-3 text-right"},Xe=["onClick"],Ye={key:2,class:"card text-center py-12"},Ze={class:"flex items-center justify-between mb-4"},Ie={class:"text-xl font-bold text-charcoal"},et={class:"space-y-3"},tt=["onClick"],st={class:"font-semibold text-charcoal"},lt={class:"text-sm text-medium-gray line-clamp-1"},it={__name:"Dashboard",setup(p){const x=X(),w=Q(),g=D(null),f=D("card"),m=D(""),u=D(""),$=D([]),V=D([]),v=C(()=>m.value||u.value),r=C(()=>m.value?V.value.filter(l=>l.department===m.value):[]);G(m,()=>{u.value&&(r.value.some(t=>t.name===u.value)||(u.value=""))});const o=C(()=>{let l=[...x.risks];return m.value&&(l=l.filter(t=>t.department===m.value)),u.value&&(l=l.filter(t=>t.unit===u.value)),l}),n=C(()=>{const l=o.value;return{total:l.length,critical:l.filter(t=>t.risk_level==="Critical").length,high:l.filter(t=>t.risk_level==="High").length,medium:l.filter(t=>t.risk_level==="Medium").length,low:l.filter(t=>t.risk_level==="Low").length,overdue:l.filter(t=>t.review_status==="Overdue").length,dueSoon:l.filter(t=>t.review_status==="Due Soon").length}}),c=C(()=>o.value.slice(0,6)),k=({risks:l})=>{l.length>0&&(g.value={risks:l})},z=l=>{w.push(`/risk/${l.name}`)},F=()=>{m.value="",u.value=""},T=l=>{const t=$.value.find(B=>B.name===l);return t?t.department_name:l},O=l=>{const t=V.value.find(B=>B.name===l);return t?t.unit_name:l},q=async()=>{try{const t=(await Y.get("/api/method/krcs_risk.krcs_risk_management.doctype.program_risk_register.api.get_departments")).data.message||[];$.value=t,V.value=t.flatMap(B=>B.units||[])}catch(l){console.error("Failed to load departments and units",l)}};return P(()=>{x.loadRisks(),q()}),(l,t)=>{const B=K("router-link");return i(),a("div",fe,[t[27]||(t[27]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-charcoal mb-2"},"Risk Dashboard"),e("p",{class:"text-medium-gray"},"Overview of organizational risk exposure and management")],-1)),e("div",ke,[e("div",be,[e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-charcoal mb-2"},"Filter by Department",-1)),H(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),class:"input"},[t[7]||(t[7]=e("option",{value:""},"All Departments",-1)),(i(!0),a(b,null,y($.value,s=>(i(),a("option",{key:s.name,value:s.name},d(s.department_name),9,ye))),128))],512),[[N,m.value]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-charcoal mb-2"},"Filter by Unit",-1)),H(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>u.value=s),class:"input",disabled:!m.value},[t[9]||(t[9]=e("option",{value:""},"All Units",-1)),(i(!0),a(b,null,y(r.value,s=>(i(),a("option",{key:s.name,value:s.name},d(s.unit_name),9,_e))),128))],8,we),[[N,u.value]])])]),v.value?(i(),a("div",Ce,[e("div",$e,[t[11]||(t[11]=e("span",{class:"text-sm text-medium-gray"},"Showing data for:",-1)),m.value?(i(),a("span",Me,d(T(m.value)),1)):R("",!0),u.value?(i(),a("span",Re,d(O(u.value)),1)):R("",!0)]),e("button",{onClick:F,class:"text-sm text-red-primary hover:text-red-hover font-medium"}," Clear Filters ")])):R("",!0)]),S(x).loading?(i(),a("div",Be,[...t[12]||(t[12]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-primary"},null,-1)])])):(i(),a("div",je,[e("div",De,[_(j,{value:n.value.total,label:"Total Risks",variant:"default",delay:0},{icon:M(()=>[...t[13]||(t[13]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])]),_:1},8,["value"]),_(j,{value:n.value.critical,label:"Critical Risks",variant:"critical",delay:100},{icon:M(()=>[...t[14]||(t[14]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)])]),_:1},8,["value"]),_(j,{value:n.value.high,label:"High Risks",variant:"high",delay:200},{icon:M(()=>[...t[15]||(t[15]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)])]),_:1},8,["value"]),_(j,{value:n.value.medium,label:"Medium Risks",variant:"medium",delay:300},{icon:M(()=>[...t[16]||(t[16]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])]),_:1},8,["value"]),_(j,{value:n.value.low,label:"Low Risks",variant:"low",delay:400},{icon:M(()=>[...t[17]||(t[17]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])]),_:1},8,["value"]),_(j,{value:n.value.overdue,label:"Overdue Reviews",variant:"critical",delay:500},{icon:M(()=>[...t[18]||(t[18]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])]),_:1},8,["value"]),_(j,{value:n.value.dueSoon,label:"Due Soon",variant:"medium",delay:600},{icon:M(()=>[...t[19]||(t[19]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1)])]),_:1},8,["value"])]),e("div",Ve,[_(ge,{matrix:S(x).riskMatrix.matrix,"risks-by-cell":S(x).riskMatrix.risksByCell,onCellClick:k},null,8,["matrix","risks-by-cell"])]),e("div",ze,[e("div",Se,[t[23]||(t[23]=e("h2",{class:"text-2xl font-bold text-charcoal"},"Recent Risks",-1)),e("div",Le,[e("div",Ae,[e("button",{type:"button",onClick:t[2]||(t[2]=s=>f.value="card"),class:h([f.value==="card"?"bg-white shadow text-charcoal":"text-medium-gray hover:text-charcoal hover:bg-white/50","inline-flex items-center px-3 py-1.5 rounded-md transition-all text-sm font-medium"])},[...t[20]||(t[20]=[e("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1),L(" Cards ",-1)])],2),e("button",{type:"button",onClick:t[3]||(t[3]=s=>f.value="table"),class:h([f.value==="table"?"bg-white shadow text-charcoal":"text-medium-gray hover:text-charcoal hover:bg-white/50","inline-flex items-center px-3 py-1.5 rounded-md transition-all text-sm font-medium"])},[...t[21]||(t[21]=[e("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),L(" Table ",-1)])],2)]),_(B,{to:"/risks",class:"btn btn-outline"},{default:M(()=>[...t[22]||(t[22]=[L(" View All Risks ",-1)])]),_:1})])]),c.value.length>0&&f.value==="card"?(i(),a("div",He,[(i(!0),a(b,null,y(c.value,s=>(i(),W(Z,{key:s.name,risk:s,onClick:A=>z(s)},null,8,["risk","onClick"]))),128))])):R("",!0),c.value.length>0&&f.value==="table"?(i(),a("div",Ne,[e("div",Ue,[e("table",Fe,[t[24]||(t[24]=e("thead",{class:"bg-light-gray"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Risk ID"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Description"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Department"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Risk Level"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Rating"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Owner"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-charcoal uppercase"},"Status"),e("th",{class:"px-4 py-3 text-right text-xs font-semibold text-charcoal uppercase"},"Actions")])],-1)),e("tbody",Te,[(i(!0),a(b,null,y(c.value,s=>(i(),a("tr",{key:s.name,class:"hover:bg-off-white transition-colors"},[e("td",Oe,d(s.name),1),e("td",qe,[e("div",Ee,d(s.risk_description),1)]),e("td",Ge,d(s.department||"-"),1),e("td",Pe,[e("span",{class:h(["px-2 py-1 rounded-full text-xs font-semibold",{"bg-critical-light text-critical-dark":s.risk_level==="Critical","bg-high-light text-high-dark":s.risk_level==="High","bg-medium-light text-medium-dark":s.risk_level==="Medium","bg-low-light text-low-dark":s.risk_level==="Low"}])},d(s.risk_level),3)]),e("td",Je,d(s.overall_rating||"-"),1),e("td",Ke,d(s.risk_owner||"-"),1),e("td",Qe,[e("span",{class:h(["px-2 py-1 rounded-full text-xs font-semibold",{"bg-green-100 text-green-700":s.status==="Open","bg-blue-100 text-blue-700":s.status==="In Progress","bg-gray-100 text-gray-600":s.status==="Closed","bg-purple-100 text-purple-700":s.status==="Mitigated"}])},d(s.status),3)]),e("td",We,[e("button",{onClick:A=>z(s),class:"text-sm text-red-primary hover:text-red-dark font-medium"}," View ",8,Xe)])]))),128))])])])])):R("",!0),c.value.length===0?(i(),a("div",Ye,[...t[25]||(t[25]=[e("svg",{class:"w-16 h-16 text-medium-gray mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"text-medium-gray"},"No risks found in the system",-1)])])):R("",!0)])])),g.value?(i(),a("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t[6]||(t[6]=s=>g.value=null)},[e("div",{class:"bg-white rounded-lg shadow-elegant-xl max-w-2xl w-full max-h-96 overflow-y-auto p-6",onClick:t[5]||(t[5]=J(()=>{},["stop"]))},[e("div",Ze,[e("h3",Ie,"Risks in Cell ("+d(g.value.risks.length)+")",1),e("button",{onClick:t[4]||(t[4]=s=>g.value=null),class:"text-medium-gray hover:text-charcoal"},[...t[26]||(t[26]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",et,[(i(!0),a(b,null,y(g.value.risks,s=>(i(),a("div",{key:s.name,class:"p-3 border border-light-border rounded-lg hover:bg-light-gray cursor-pointer",onClick:A=>z(s)},[e("div",st,d(s.name),1),e("div",lt,d(s.risk_description),1)],8,tt))),128))])])])):R("",!0)])}}},ut=U(it,[["__scopeId","data-v-61f31d57"]]);export{ut as default};
